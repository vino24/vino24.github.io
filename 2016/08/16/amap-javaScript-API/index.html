<!DOCTYPE html>
<html manifest="index.manifest">
    <head>
    <!-- Title -->
    
    <title>
        基于高德地图API开发的通用地点选择组件 | 逢十借一
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/apple-touch-icon.png">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    <link rel="manifest" href="manifest.json">
    <!-- Meta & INfo -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="vino24">
    <meta name="description" content="web前端开发, 前端开发工程师, 前端开发攻城师, 前端资源, CSS, JavaScript, HTML, Web标准">
    <meta name="keywords" content="web前端开发, 前端开发工程师, 前端开发攻城师, 前端资源, CSS, JavaScript, HTML, Web标准">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="逢十借一">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://vino24.cn">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="基于高德地图API开发的通用地点选择组件 | 逢十借一">
    <meta property="og:description" content="web前端开发, 前端开发工程师, 前端开发攻城师, 前端资源, CSS, JavaScript, HTML, Web标准">

     <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
	body, html{
		font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
	}
	
    a{
        color: #00838F
    }
    
    .mdl-card__media,
    #search-label,
    #search-form-label:after,
    #scheme-Paradox .hot_tags-count,
    #scheme-Paradox .sidebar_archives-count,
    #scheme-Paradox .sidebar-colored .sidebar-header,
    #scheme-Paradox .sidebar-colored .sidebar-badge{
        background-color: #0097A7 !important
    }
    
	/* Sidebar User Drop Down Menu Text Color */
	#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus{
        color: #0097A7 !important
    }
    
    #post_entry-right-info,
    .sidebar-colored .sidebar-nav li:hover > a,
    .sidebar-colored .sidebar-nav li:hover > a i,
    .sidebar-colored .sidebar-nav li > a:hover,
    .sidebar-colored .sidebar-nav li > a:hover i,
    .sidebar-colored .sidebar-nav li > a:focus i,
    .sidebar-colored .sidebar-nav > .open > a,
    .sidebar-colored .sidebar-nav > .open > a:hover,
    .sidebar-colored .sidebar-nav > .open > a:focus,
    #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a{
        color: #0097A7 !important
    }
    
    .toTop{
        background: #757575 !important
    }
		
	.material-layout .material-post>.material-nav,
	.material-layout .material-index>.material-nav,
	.material-nav a{
		color: #757575;
	}
		
	#scheme-Paradox .MD-burger-layer {
		background-color: #757575;
	}

	#scheme-Paradox #post-toc-trigger-btn{
		color: #757575;
	}
	
	.post-toc a:hover{
		color: #00838F;
		text-decoration: underline;
	}
</style>


<!-- Theme Background Related-->

	<style>
		body{
            background-image: url(https://api.i-meto.com/bing?new);
        }
	</style>




<!-- Fade Effect -->

    <style>
        .fade {
            transition: all 800ms linear;
            -webkit-transform: translate3d(0,0,0);
            -moz-transform: translate3d(0,0,0);
            -ms-transform: translate3d(0,0,0);
            -o-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
            opacity: 1;
        }

        .fade.out{
            opacity: 0;
        }
    </style>

	<script src="/js/jquery.min.js"></script>

	<link rel="stylesheet" href="/css/highlight/solarized-white.css">

	<!-- UC Browser Compatible-->
	<script>
		var agent = navigator.userAgent.toLowerCase();
		if(agent.indexOf('ucbrowser')>0) {
			document.write('<link rel="stylesheet" href="/css/uc.css">');
		   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
		}
	</script>

    <!-- Custom Head -->
    
</head>


	

    <body id="scheme-Paradox">


        <div class="material-layout  mdl-js-layout has-drawer is-upgraded">

			

            <!-- Main Container -->
            <main class="material-layout__content" id="main">

                <!-- Top Anchor -->
                <div id="top"></div>

				
                <!-- Hamburger Button -->
                <button class="MD-burger-icon sidebar-toggle">
                    <span class="MD-burger-layer"></span>
                </button>
				

                <!-- Post TOC -->

    
	<!-- Back Button -->
<!--
	<div class="material-back" id="backhome-div" tabindex="0">
		<a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" href="#" onclick="window.history.back();return false;" target="_self" role="button" data-upgraded=",MaterialButton,MaterialRipple">
			<i class="material-icons" role="presentation">arrow_back</i>
			<span class="mdl-button__ripple-container">
				<span class="mdl-ripple"></span>
			</span>
		</a>
	</div>			
-->
	<!-- Left aligned menu below button -->
	<button id="post-toc-trigger-btn"
			class="mdl-button mdl-js-button mdl-button--icon">
	  <i class="material-icons">format_list_numbered</i>
	</button>

	<ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect"
		for="post-toc-trigger-btn">
			
			<ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#开始"><span class="post-toc-number">1.</span> <span class="post-toc-text">开始</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#引入插件"><span class="post-toc-number">2.</span> <span class="post-toc-text">引入插件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#插件加载方式"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">插件加载方式</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#初始化"><span class="post-toc-number">3.</span> <span class="post-toc-text">初始化</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#初始化地图容器"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">初始化地图容器</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#初始化输入提示"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">初始化输入提示</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#初始化搜索"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">初始化搜索</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#填充默认值"><span class="post-toc-number">4.</span> <span class="post-toc-text">填充默认值</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#定位到当前行政区"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">定位到当前行政区</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#核心业务逻辑"><span class="post-toc-number">5.</span> <span class="post-toc-text">核心业务逻辑</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#静态地图"><span class="post-toc-number">6.</span> <span class="post-toc-text">静态地图</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#参考"><span class="post-toc-number">7.</span> <span class="post-toc-text">参考:</span></a></li></ol>
		
<!--			<li class="mdl-menu__item">Some Action</li>-->
	</ul>



<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">
		
        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
	<!-- Paradox Post Header -->
	
		
			<!-- Random Thumbnail -->
			<div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
				<script>
    
    var randomNum;
    randomNum = Math.floor(Math.random() * 5 + 1);
    
    $(".post_thumbnail-random").css('background-image', 'url(' + '/img/random/' + randomNum + '.png' + ')');
    
</script>

		
	
        <p class="article-headline-p">
            基于高德地图API开发的通用地点选择组件
        </p>
    </div>

	

				
				
					<!-- Paradox Post Info -->
					<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
    
    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>vino24</strong>
        <span>8月 16, 2016</span>
    </div>
    
    <div class="section-spacer"></div>
	
    <!-- Favorite -->
<!--
    <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
        <i class="material-icons" role="presentation">favorite</i>
        <span class="visuallyhidden">favorites</span>
    </button>
-->
    
    <!-- Tags (bookmark) -->
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        
    </ul>
    
    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    
    
    
    
    <!-- Share Twitter -->
    <a class="post_share-link" href="https://twitter.com/intent/tweet?text=基于高德地图API开发的通用地点选择组件&url=http://vino24.cn//2016/08/16/amap-javaScript-API/index.html&via=vino24" target="_blank">
        <li class="mdl-menu__item">
            分享到 Twitter
        </li>
    </a>
    
    <!-- Share Google+ -->
    <a class="post_share-link" href="https://plus.google.com/share?url=http://vino24.cn//2016/08/16/amap-javaScript-API/index.html" target="_blank">
        <li class="mdl-menu__item">
            分享到 Google+
        </li>
    </a>
    
    <!-- Share Weibo -->
    <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=基于高德地图API开发的通用地点选择组件&url=http://vino24.cn//2016/08/16/amap-javaScript-API/index.html&pic=&searchPic=false&style=simple" target="_blank">
        <li class="mdl-menu__item">
            分享到微博
        </li>
    </a>
</ul>
</div>
				

                <!-- Post Content -->
                <div id="post-content" class="markdown-Github mdl-color-text--grey-700 mdl-card__supporting-text fade out">
	
		<script src="/assets/js/APlayer.min.js"> </script><blockquote>
<p>最近有个邀请函的需求，其中有一个地点选择的需求。大致的流程是：<br>信息填写页 - (点击) - 地图选择页面 -(搜索选择地点后返回) - 数据自动填充到信息页面</p>
</blockquote>
<p>之前没有接触过基于地图API的开发，目前国内的主流的两款地图软件也就高德和百度，简单看了下两个的API文档，最后选择高德，个人感觉高德的API文档写的要好点。</p>
<h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><p>高德地图有很多，我们这里选择的是JavaScript API，要使用某个具体的首先要申请key，然后就可以在页面引入API文件了：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"http://webapi.amap.com/maps?v=1.3&amp;key=您申请的key值"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h3 id="引入插件"><a href="#引入插件" class="headerlink" title="引入插件"></a>引入插件</h3><p>这里需要用到高德的三个插件:</p>
<ol>
<li>AMap.CitySearch 城市查询插件</li>
<li>AMap.Autocomplete 输入提示插件</li>
<li>AMap.PlaceSearch 地点选择插件</li>
</ol>
<h4 id="插件加载方式"><a href="#插件加载方式" class="headerlink" title="插件加载方式"></a>插件加载方式</h4><p>插件有两种加载方式，一种是在引入API时通过添加参数来实现</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span></div><div class="line">        src=<span class="string">"http://webapi.amap.com/maps?v=1.3&amp;key=54e484931a6a428c50da305c82bc709a&amp;plugin=AMap.Autocomplete,AMap.PlaceSearch,AMap.CitySearch"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>另外一种是在代码中通过AMap.plugin方法来使用(PlaceSearch用的是AMap.service方法,一些其他插件也有使用此方法的，搞不太明白差别)</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">AMap.plugin(<span class="string">'AMap.Autocomplete'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">//回调函数</span></div><div class="line">        <span class="comment">//实例化Autocomplete</span></div><div class="line">        <span class="keyword">var</span> autoOptions = &#123;</div><div class="line">            <span class="attr">city</span>: <span class="string">""</span>, <span class="comment">//城市，默认全国</span></div><div class="line">            input:<span class="string">"input_id"</span><span class="comment">//使用联想输入的input的id</span></div><div class="line">        &#125;;</div><div class="line">        autocomplete= <span class="keyword">new</span> AMap.Autocomplete(autoOptions);</div><div class="line">        <span class="comment">//<span class="doctag">TODO:</span> 使用autocomplete对象调用相关功能</span></div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<p>个人感觉还是第一种方式更灵活一些。</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><h4 id="初始化地图容器"><a href="#初始化地图容器" class="headerlink" title="初始化地图容器"></a>初始化地图容器</h4><p>要使用地图需要指定页面中的某元素为地图容器，通过Amap.Map方法来创建容器<br><figure class="highlight lasso"><table><tr><td class="code"><pre><div class="line"><span class="built_in">var</span> <span class="built_in">map</span> = <span class="literal">new</span> AMap.<span class="built_in">Map</span>(<span class="string">'container'</span>,&#123;</div><div class="line">        zoom: <span class="number">10</span>,</div><div class="line">        center: <span class="meta">[</span><span class="number">116.39</span>,<span class="number">39.9</span><span class="meta">]</span></div><div class="line">    &#125;);</div></pre></td></tr></table></figure></p>
<blockquote>
<p>需要特别注意的是这里的map需要是全局的或者要暴露给全局，因为高德地图的<code>http://cache.amap.com/lbs/static/addToolbar.js</code>中需要使用map。所以最好的方法是在初始化后挂在window上<br><code>window.map = map;</code></p>
<h4 id="初始化输入提示"><a href="#初始化输入提示" class="headerlink" title="初始化输入提示"></a>初始化输入提示</h4><figure class="highlight actionscript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> auto = <span class="keyword">new</span> AMap.Autocomplete(&#123;</div><div class="line">     input: <span class="string">'tipinput'</span> <span class="comment">// 绑定输入提示框元素id</span></div><div class="line"> &#125;);</div></pre></td></tr></table></figure>
</blockquote>
<h4 id="初始化搜索"><a href="#初始化搜索" class="headerlink" title="初始化搜索"></a>初始化搜索</h4><figure class="highlight actionscript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> placeSearch = <span class="keyword">new</span> AMap.PlaceSearch(&#123; <span class="comment">//构造地点查询类</span></div><div class="line">        pageSize: <span class="number">5</span>,</div><div class="line">        pageIndex: <span class="number">1</span>,</div><div class="line">        city: <span class="string">"010"</span>, <span class="comment">//城市</span></div><div class="line">        map: map,</div><div class="line">        panel: <span class="string">"result"</span>         <span class="comment">// 搜索结果显示列表绑定元素的id</span></div><div class="line">    &#125;);</div><div class="line">    <span class="comment">//关键字查询</span></div><div class="line">    placeSearch.search(<span class="string">'方恒'</span>, <span class="function"><span class="keyword">function</span><span class="params">(status, result)</span> </span>&#123;</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>实际项目中更多的是输入提示和搜索结合起来使用，本项目中就是这样用的，在输入时使用输入提示插件，然后当点击提示列表中的某一项时调用搜索。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">AMap.plugin([<span class="string">'AMap.Autocomplete'</span>,<span class="string">'AMap.PlaceSearch'</span>],<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">     <span class="keyword">var</span> autoOptions = &#123;</div><div class="line">          <span class="attr">city</span>: <span class="string">"北京"</span>, <span class="comment">//城市，默认全国</span></div><div class="line">          input: <span class="string">"input"</span><span class="comment">//使用联想输入的input的id</span></div><div class="line">     &#125;;</div><div class="line">     autocomplete= <span class="keyword">new</span> AMap.Autocomplete(autoOptions);</div><div class="line">     <span class="keyword">var</span> placeSearch = <span class="keyword">new</span> AMap.PlaceSearch(&#123;</div><div class="line">              <span class="attr">city</span>:<span class="string">'北京'</span>,</div><div class="line">              <span class="attr">map</span>:map</div><div class="line">     &#125;);</div><div class="line">     AMap.event.addListener(autocomplete, <span class="string">"select"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">           <span class="comment">//TODO 针对选中的poi实现自己的功能</span></div><div class="line">           placeSearch.search(e.poi.name)</div><div class="line">     &#125;);</div><div class="line"> &#125;);</div></pre></td></tr></table></figure>
<h3 id="填充默认值"><a href="#填充默认值" class="headerlink" title="填充默认值"></a>填充默认值</h3><blockquote>
<p>邀请函填写页面的逻辑是用户切换到地点输入一栏时直接跳转到地图页面，也就是说初次跳到地图页面是没有带搜索关键词的，所以需要一个默认值，这里我选择的是当前城市名称作为默认关键词。而这就要先获取到当前城市。</p>
</blockquote>
<h4 id="定位到当前行政区"><a href="#定位到当前行政区" class="headerlink" title="定位到当前行政区"></a>定位到当前行政区</h4><p>关于定位到当前位置有许多种定位方式，大致看了一下每种定位方式的用法，最终选择选择了ip定位，因为相较其他之中没有过多限制，实现起来也相对简单。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">//实例化城市查询类</span></div><div class="line"><span class="keyword">var</span> citysearch = <span class="keyword">new</span> AMap.CitySearch();</div><div class="line"><span class="comment">//自动获取用户IP，返回当前城市</span></div><div class="line">citysearch.getLocalCity(<span class="function"><span class="keyword">function</span>(<span class="params">status, result</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (status === <span class="string">'complete'</span> &amp;&amp; result.info === <span class="string">'OK'</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (result &amp;&amp; result.city &amp;&amp; result.bounds) &#123;</div><div class="line">            <span class="keyword">var</span> cityinfo = result.city;</div><div class="line">            <span class="keyword">var</span> citybounds = result.bounds;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="核心业务逻辑"><a href="#核心业务逻辑" class="headerlink" title="核心业务逻辑"></a>核心业务逻辑</h3><blockquote>
<p>大致的业务逻辑为首先一进来先解析URL，然后获取其中关键词进行搜索，搜索结果返回后为每一项绑定点击事件，点击后即进行新一轮搜索。</p>
</blockquote>
<p>核心代码:<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 获取当前城市名称</span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">currentCityInfo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line">                <span class="comment">//实例化城市查询类</span></div><div class="line">                <span class="keyword">var</span> citysearch = <span class="keyword">new</span> AMap.CitySearch();</div><div class="line">                <span class="comment">//自动获取用户IP，返回当前城市</span></div><div class="line">                citysearch.getLocalCity(<span class="function"><span class="keyword">function</span> (<span class="params">status, result</span>) </span>&#123;</div><div class="line">                    <span class="keyword">if</span> (status === <span class="string">'complete'</span> &amp;&amp; result.info === <span class="string">'OK'</span>) &#123;</div><div class="line">                        <span class="keyword">if</span> (result &amp;&amp; result.city) &#123;</div><div class="line">                            resolve(result);</div><div class="line">                        &#125;</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        reject(<span class="keyword">new</span> <span class="built_in">Error</span>(result.infocode));</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">// 关键词搜索</span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">chooseLocation</span>(<span class="params">keyword, adcode</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line">                <span class="comment">//接收url中传入的搜索值</span></div><div class="line">                AMap.service([<span class="string">'AMap.PlaceSearch'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="comment">//关键字查询</span></div><div class="line">                    <span class="keyword">var</span> placeSearch = initSearch();</div><div class="line">                    placeSearch.setCity(adcode || <span class="string">'100000'</span>);</div><div class="line">                    placeSearch.search(keyword, <span class="function"><span class="keyword">function</span> (<span class="params">status, result</span>) </span>&#123;</div><div class="line">                        <span class="keyword">if</span> (status === <span class="string">'complete'</span> &amp;&amp; result.info === <span class="string">'OK'</span>) &#123;</div><div class="line">                            resolve(result);</div><div class="line">                        &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            reject(<span class="keyword">new</span> <span class="built_in">Error</span>(result.info));</div><div class="line">                        &#125;</div><div class="line">                    &#125;);</div><div class="line">                &#125;);</div><div class="line">            &#125;)</div><div class="line">        &#125;;        </div><div class="line">        </div><div class="line">    <span class="keyword">if</span> (location.search.indexOf(<span class="string">"&amp;"</span>) !== <span class="number">-1</span>)    <span class="comment">// 如果不是初次搜索，展示上次搜索结果</span></div><div class="line">    <span class="keyword">return</span> <span class="built_in">decodeURIComponent</span>(location.search.substr(<span class="number">1</span>).split(<span class="string">"&amp;"</span>)[<span class="number">0</span>].split(<span class="string">'='</span>)[<span class="number">1</span>]);</div><div class="line">    <span class="keyword">else</span> &#123;  <span class="comment">// 首次搜索，首先获取当前城市</span></div><div class="line">            currentCityInfo()</div><div class="line">            .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                 <span class="keyword">return</span> data.city;</div><div class="line">            &#125;</div><div class="line">        &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123; <span class="built_in">console</span>.log(error); &#125;)</div><div class="line">        .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">            chooseLocation(data())</div><div class="line">         .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> poiArr = data.poiList.pois,</div><div class="line">                        resultCount = poiArr.length;</div><div class="line">                markerPoints = []; <span class="comment">// 清空上次搜索的数据</span></div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; resultCount; i++) &#123;</div><div class="line">                    addMarker(poiArr[i]);</div><div class="line">                &#125;</div><div class="line">                point = markerPoints[<span class="number">0</span>];</div><div class="line">                setStorage(poiArr[<span class="number">0</span>].name, getImgUrl());</div><div class="line">                <span class="comment">//注册监听，当选中某条记录时会触发</span></div><div class="line">                AMap.event.addListener(auto, <span class="string">"select"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">                    chooseLocation(e.poi.name, e.poi.adcode).then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">                        <span class="keyword">var</span> poiArr = data.poiList.pois,</div><div class="line">                                resultCount = poiArr.length;</div><div class="line">                        markerPoints = []; <span class="comment">// 清空上次搜索的数据</span></div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; resultCount; i++) &#123;</div><div class="line">                            addMarker(poiArr[i]);</div><div class="line">                        &#125;</div><div class="line">                    &#125;); <span class="comment">//  选中某条纪录后再次触发搜索,重新绘制地图</span></div><div class="line">                &#125;);</div><div class="line">                <span class="keyword">return</span> data;</div><div class="line">            &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(error);</div><div class="line">            &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="comment">//  panel列表项切换</span></div><div class="line">                <span class="built_in">document</span>.getElementById(<span class="string">'panel'</span>).addEventListener(<span class="string">'click'</span>, clickItem, <span class="literal">false</span>);</div><div class="line">            &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(error);</div><div class="line">            &#125;)</div><div class="line">        &#125;)</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<h3 id="静态地图"><a href="#静态地图" class="headerlink" title="静态地图"></a>静态地图</h3><p>地图组件最终返回的具体的地点和一张静态地图。对于静态地图的获取需要用到高德地图的Web服务API，首先要申请Web服务API的key。然后要做的就是依照规范拼接出URL。</p>
<ol>
<li>服务地址：<a href="http://restapi.amap.com/v3/staticmap?parameters" target="_blank" rel="external">http://restapi.amap.com/v3/staticmap?parameters</a> 所有参数均使用和号字符(&amp;)进行分隔</li>
<li>常用的请求参数：<pre><code>* key: 用户申请的key
* location：地图的中心点坐标
* zoom：缩放级别，范围为［1，19］(官方文档中写的是[1,17],但实际最大可以到19)
* size：地图大小
* markers：标注
</code></pre></li>
<li>markers：<blockquote>
<p>在众多的参数中，最终决定地图绘制的即我们需要自己去通过一步步构造的为markers(labels和paths也很常用，但是项目中没有用到，原理类似不做讨论)</p>
</blockquote>
</li>
</ol>
<ul>
<li>格式:<br><code>markers=markersStyle1:location1;location2..|markersStyle2:location3;location4..|markersStyleN:locationN;locationM..</code><br>location为经纬度信息，经纬度之间使用”,”分隔，不同的点使用”;”分隔。 markersStyle可以使用系统提供的样式，也可以使用自定义图片。</li>
<li>markersStyle参数:<ul>
<li>size:值small mid large</li>
<li>color: 颜色</li>
<li>label: [0-9]、[A-Z]、[单个中文字] (当size为small时不展现标注名)<h3 id="参考"><a href="#参考" class="headerlink" title="参考:"></a>参考:</h3></li>
</ul>
</li>
</ul>
<ol>
<li><a href="http://lbs.amap.com/api/javascript-api/guide/quickstart/" target="_blank" rel="external">高德地图JavaScript API 参考文档</a></li>
<li><a href="http://lbs.amap.com/api/webservice/reference/staticmaps/" target="_blank" rel="external">静态地图</a></li>
</ol>

	
	
	
	
</div>
				
				

                <!-- Post Comments -->
                
                    
    <!-- 使用多说评论 -->
    <link rel="stylesheet" href="/css/duoshuo.min.css">
<style>
    #ds-thread #ds-reset .ds-post-button{
        background-color: #0097A7 !important;
    }
    #ds-wrapper #ds-reset .ds-icons-32{
        background-color: #0097A7 !important;
    }
    #ds-reset .ds-highlight {
        color: #0097A7 !important;
    }
</style>
<div id="comments">
    <!-- 多说评论框 start -->
        <div class="ds-thread" 
            data-thread-key="2016/08/16/amap-javaScript-API/" 
            data-url="http://vino24.cn/2016/08/16/amap-javaScript-API/"
            data-title="基于高德地图API开发的通用地点选择组件"></div>
    <!-- 多说评论框 end -->
</div>



                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    
    <!-- Prev Nav -->
    
        <a href="/2016/08/17/ES2015-Object/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2016/08/15/2016-08-15/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>
        </div>
    </div>


				
					<!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay "></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored  sidebar-fixed-left" role="navigation">
	<div id="sidebar-main">
	    <!-- Sidebar Header -->
		<div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="vino24's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        jzwmxz@hotmail.com
        <b class="caret"></b>
    </a>
</div>

		<!-- Sidebar Navigation  -->
		<ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
			
                <li>
                    <a href="jzwmxz@hotmail.com" target="_blank" title="Email Me">
						<i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    <li id="sidebar-first-li">
        <a href="/" target="_self">
            <i class="material-icons sidebar-material-icons">home</i>
             主页
        </a>
    </li>

    <!-- I'm Feeling Lucky -->
<!--
    <li class="dropdown">
        <a href="" target="_self">
            <i class="material-icons sidebar-material-icons">explore</i>
             sidebar.imlucky
        </a>
    </li>
-->

	
    <!-- Archives  -->
    <li class="dropdown">
        <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
            <i class="material-icons sidebar-material-icons">inbox</i>
             归档
            <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
            <li>
            <a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">五月 2016<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">四月 2016<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/02/">二月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">一月 2016<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">十二月 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/09/">九月 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/08/">八月 2015<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/07/">七月 2015<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">六月 2015<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/05/">五月 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/04/">四月 2015<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/03/">三月 2015<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/01/">一月 2015<span class="sidebar_archives-count">1</span></a>
        </ul>
    </li>

    <!-- Divider -->
    <li class="divider"></li>


    <!-- Pages  -->
	
		<li>
			<a href="/about" title="关于我">
				关于我
			</a>
		</li>
	
		<li>
			<a href="/tagcloud" title="标签云">
				标签云
			</a>
		</li>
	

    <!-- Article Numebr  -->
    <li>
        <a href="/archives">
             文章总数
             <span class="sidebar-badge">107</span>
        </a>
    </li>
</ul>

		<!-- Sidebar Divider -->
		<div class="sidebar-divider"></div>

		<!-- Sidebar Footer -->
		<!-- 
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持。 :) 
-->

<!-- Theme Material -->
<a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
	<div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		主题 - Material
		<span class="sidebar-badge badge-circle">i</span>
	</div>
</a>

<!-- Help & Support -->
<!--
<a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		sidebar.help
		<span class="mdl-button__ripple-container">
			<span class="mdl-ripple"></span>
		</span>
	</div>
</a>
-->

<!-- Feedback -->
<!--
<a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.feedback
                    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>
-->

<!-- Abount Theme -->
<!--
<a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.about_theme
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>-->

	</div>
    
    <!-- Sidebar Sponsor -->
    


</aside>

				

				
					<!-- Footer Top Button -->
					<div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>
				

				<!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
	
	
		<!-- Paradox Footer Left Section -->
		<div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
    
    
    <!-- Facebook -->
    
    
    
    <!-- Google + -->
    
    
    
    <!-- Weibo -->
    
    
    
    <!-- Instagram -->
    
    
    
    <!-- Tumblr -->
    
    
    
    <!-- Github -->
    
    <a href="https://github.com/vino24/" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
        <span class="visuallyhidden">Github</span>
    </button></a>
    
</div>


		<!--Copyright-->
		<div id="copyright">Copyright&nbsp;©&nbsp;<script type="text/javascript">var fd = new Date();document.write(fd.getFullYear());</script>&nbsp;逢十借一</div>

		<!-- Paradox Footer Right Section -->

		<!-- 
		I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright.
		It will not impact the appearance and can give developers a lot of support :)

		很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
		它不会影响美观并可以给开发者很大的支持。 :) 
		-->

		<div class="mdl-mini-footer--right-section">
			<div>
				<div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
				<div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
			</div>
		</div>
	
    
</footer>

				<!-- Import File -->
<script src="/js/highlight.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    
    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });
    
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>








    <!-- 多说公共 js 代码 start -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"vino24"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = 'https://static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
             || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- 多说公共 js 代码 end -->




<!-- Swiftye -->


<!-- Local Search-->

	<script>
	var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        success: function( xmlResponse ) {
            // get the contents from search data
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length <= 0) {
                    return;
                }
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        str += "<li><a href='"+ data_url +"' class='search-result-title' target='_blank'>"+ data_title;
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out characters
                            var start = first_occur - 6;
                            var end = first_occur + 6;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 10;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substr(start, end); 
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<em class=\"search-keyword\">"+keyword+"</em>");
                            })
                            str += "<p class=\"search-result\">" + match_content +"...</p>" +"</a>";
                        }
                    }
                })
                $resultContent.innerHTML = str;
            })
        }
    })
}
</script>

	<script>
        var inputArea = document.querySelector("#search");
        var getSearchFile = function(){
            var path = "search.xml";
            searchFunc(path, 'search', 'local-search-result');
        }

        inputArea.onfocus = function(){ getSearchFile() }
	</script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $(".post-toc-wrap").parent(".mdl-menu__container").css("position", "fixed");
    });
</script>

<!-- MathJax Load-->

            </main>
        </div>

    </body>

	
</html>
