<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="webå‰ç«¯å¼€å‘, å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ, å‰ç«¯å¼€å‘æ”»åŸå¸ˆ, å‰ç«¯èµ„æº, CSS, JavaScript, HTML, Webæ ‡å‡†"><meta name="theme-color" content="#db5945"><title>å¾®ä¿¡ç‚¹æ­Œæ¨¡å—ä»£ç æ›´æ–°åŠhexoéŸ³ä¹æ’ä»¶ | é€¢åå€Ÿä¸€</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">å¾®ä¿¡ç‚¹æ­Œæ¨¡å—ä»£ç æ›´æ–°åŠhexoéŸ³ä¹æ’ä»¶</h1><a id="logo" href="/.">é€¢åå€Ÿä¸€</a><p class="description">å’Œè‡ªå·±èµ›è·‘çš„äºº</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">å¾®ä¿¡ç‚¹æ­Œæ¨¡å—ä»£ç æ›´æ–°åŠhexoéŸ³ä¹æ’ä»¶</h1><div class="post-meta">Oct 31, 2016<span> | </span><span class="category"><a href="/categories/æ€»ç»“/">æ€»ç»“</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/10/31/wechat-music-serach-module-update/" href="/2016/10/31/wechat-music-serach-module-update/#comments" class="ds-thread-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-æœç´¢æ¨¡å—é‡å†™"><span class="toc-number">1.</span> <span class="toc-text">[1] æœç´¢æ¨¡å—é‡å†™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-hexoéŸ³ä¹æ’ä»¶"><span class="toc-number">2.</span> <span class="toc-text">[2] hexoéŸ³ä¹æ’ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-å°ç»“"><span class="toc-number">3.</span> <span class="toc-text">[3] å°ç»“:</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-æ•°æ®è½¬æ¢"><span class="toc-number">3.1.</span> <span class="toc-text">[1] æ•°æ®è½¬æ¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-nodeä¸­çš„åŒæ­¥è¯·æ±‚"><span class="toc-number">3.2.</span> <span class="toc-text">[2] nodeä¸­çš„åŒæ­¥è¯·æ±‚</span></a></li></ol></li></ol></div></div><div class="post-content"><script src="/assets/js/APlayer.min.js"> </script><h3 id="1-æœç´¢æ¨¡å—é‡å†™"><a href="#1-æœç´¢æ¨¡å—é‡å†™" class="headerlink" title="[1] æœç´¢æ¨¡å—é‡å†™"></a>[1] æœç´¢æ¨¡å—é‡å†™</h3><p>ç”±äºäº‘éŸ³ä¹é‚£è¾¹æ¥å£çš„å˜åŠ¨åŸæœ¬çš„éŸ³ä¹æœç´¢åŠŸèƒ½æ²¡æ³•ä½¿ç”¨äº†ï¼Œäºæ˜¯å°±é‡å†™äº†ä¸€ä¸‹ã€‚ä¸»è¦æ˜¯å…³é”®è¯æœç´¢çš„å‡½æ•°ï¼Œå…¶é—´å‘ç°å…¶æœç´¢çš„é€»è¾‘ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œæ‰€ä»¥ç›¸åº”çš„å…³é”®è¯åˆ†æåŒ¹é…çš„åœ°æ–¹ä¹Ÿå¾—é‡å†™ã€‚</p>
<p>æ ¸å¿ƒçš„å…³é”®è¯æœç´¢å‡½æ•°music_search<br><figure class="highlight php"><table><tr><td class="code"><pre><div class="line"><span class="comment">// @param</span></div><div class="line"><span class="comment">// s:æœç´¢å…³é”®è¯</span></div><div class="line"><span class="comment">// type: ç±»å‹(1:æ­Œæ›²,100æ­Œæ‰‹)</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">music_search</span><span class="params">($s,$type=<span class="number">1</span>)</span></span></div><div class="line">&#123;</div><div class="line">    $type||$type=<span class="number">1</span>;</div><div class="line">    $url= <span class="string">"http://music.163.com/api/search/get/web?csrf_token="</span>;</div><div class="line">    $curl = curl_init();</div><div class="line">    $post_data = <span class="string">'hlpretag=&amp;hlposttag=&amp;s='</span>. $s . <span class="string">'&amp;type='</span>.$type.<span class="string">'&amp;offset=0&amp;total=true&amp;limit=1'</span>;</div><div class="line">    curl_setopt($curl, CURLOPT_URL,$url);</div><div class="line">    curl_setopt($curl, CURLOPT_RETURNTRANSFER,<span class="number">1</span>);</div><div class="line">    $header =<span class="keyword">array</span>(</div><div class="line">        <span class="string">'Host: music.163.com'</span>,</div><div class="line">        <span class="string">'Origin: http://music.163.com'</span>,</div><div class="line">        <span class="string">'User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.90 Safari/537.36'</span>,</div><div class="line">        <span class="string">'Content-Type: application/x-www-form-urlencoded'</span>,</div><div class="line">        <span class="string">'Referer: http://music.163.com/search/'</span>,</div><div class="line">    );</div><div class="line">    curl_setopt($curl, CURLOPT_HTTPHEADER, $header);</div><div class="line">    curl_setopt($curl, CURLOPT_POST, <span class="number">1</span>);</div><div class="line">    curl_setopt($curl, CURLOPT_POSTFIELDS, $post_data);</div><div class="line">    $src = curl_exec($curl);</div><div class="line">    curl_close($curl);</div><div class="line">    <span class="keyword">return</span> $src;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è·å–å¾®ä¿¡ä¸­éœ€è¦æ•°æ®å‡½æ•°getWechatFormatData(æ ¸å¿ƒä»£ç )<br><figure class="highlight php"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getWechatFormatData</span><span class="params">($word)</span></span></div><div class="line">&#123;</div><div class="line">    $result = json_decode(music_search($word), <span class="keyword">true</span>); <span class="comment">// é»˜è®¤æŒ‰æ­Œæ›²å…ˆæœç´¢ä¸€æ¬¡ï¼ˆtrueè½¬æ¢ä¸ºæ•°ç»„ï¼‰</span></div><div class="line"></div><div class="line">    $is_Song = <span class="keyword">false</span>;   <span class="comment">// æœç´¢å…³é”®è¯æ˜¯å¦ä¸ºæ­Œæ›²</span></div><div class="line">    $isEnglish = preg_match(<span class="string">"/^[a-zA-Z\s]+$/"</span>,$word);   <span class="comment">// æ˜¯å¦ä¸ºè‹±æ–‡æ­Œ/æ­Œæ‰‹</span></div><div class="line">    $arr = preg_split(<span class="string">"/[\s,]+/"</span>, $word);</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(!$isEnglish) &#123;</div><div class="line">        <span class="keyword">if</span>(count($arr) == <span class="number">1</span>) &#123; <span class="comment">// éè‹±æ–‡ä¸”åªæœ‰ä¸€ä¸ªæœç´¢å…³é”®è¯</span></div><div class="line">        $is_Song = $result[<span class="string">'result'</span>][<span class="string">'songs'</span>][<span class="number">0</span>][<span class="string">'name'</span>] == $word; <span class="comment">// å¦‚æœè¿”å›çš„æ­Œæ›²åä¸æœç´¢å…³é”®è¯ç›¸åŒå³è¡¨ç¤ºå…³é”®è¯ä¸ºæ­Œæ›²</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;    <span class="comment">// éè‹±æ–‡ä¸”å¤šä¸ªå…³é”®è¯</span></div><div class="line">        <span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $key =&gt; $keyword) &#123;</div><div class="line">            $result = json_decode(music_search($keyword) ,<span class="keyword">true</span>);</div><div class="line">            <span class="keyword">if</span>($result[<span class="string">'result'</span>][<span class="string">'songs'</span>][<span class="number">0</span>][<span class="string">'name'</span>] == $keyword) &#123;</div><div class="line">                $is_Song = <span class="keyword">true</span>;    <span class="comment">//  å¦‚æœæœç´¢ç»“æœä¸­çš„æ­Œæ›²åä¸å…³é”®è¯ä¸­çš„æŸå­—æ®µåŒ¹é…åˆ™è¯¥å­—æ®µä¸ºæ­Œæ›²å</span></div><div class="line">                $result = json_decode(music_search($arr[$key]) , <span class="keyword">true</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;    <span class="comment">//  å…¨è‹±æ–‡</span></div><div class="line">        $is_Song = stristr($word,$result[<span class="string">'result'</span>][<span class="string">'songs'</span>][<span class="number">0</span>][<span class="string">'name'</span>]); <span class="comment">// å¦‚æœæœç´¢ç»“æœä¸­çš„æ­Œæ›²åä¸­æœ‰æŸä¸ªå­—æ®µåˆ™æŒ‰æ­Œæ›²æœç´¢ï¼Œå¦åˆ™æŒ‰æ­Œæ‰‹æœç´¢</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> ($is_Song) &#123;</div><div class="line">        <span class="comment">// do operation</span></div><div class="line">        <span class="keyword">return</span> $info;</div><div class="line">    &#125;</div><div class="line">     <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// do operation</span></div><div class="line">        <span class="keyword">return</span> $info;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="2-hexoéŸ³ä¹æ’ä»¶"><a href="#2-hexoéŸ³ä¹æ’ä»¶" class="headerlink" title="[2] hexoéŸ³ä¹æ’ä»¶"></a>[2] hexoéŸ³ä¹æ’ä»¶</h3><p>å‰ä¸¤å¤©åœ¨å¾®åšä¸Šçœ‹åˆ°èƒ¡å­æ­Œåœ¨barretlee.comä¸Šåšäº†ä¸€ä¸ªæ­Œå•å±•ç¤ºé¡µï¼Œä¸Šé¢ç«Ÿç„¶æå¿—ï¼Œä¸è¡Œæˆ‘ä¹Ÿå¾—æ•´ä¸€ä¸ªã€‚çœ‹ä»–è¯´UIæ˜¯ç”¨äº†ä¸€æ¬¾å¼€æºçš„æ’­æ”¾å™¨<a href="https://github.com/DIYgod/APlayer" target="_blank" rel="external">APlayer</a>,äºæ˜¯ç®€å•çœ‹äº†ä¸‹ï¼Œå·§çš„æ˜¯å·²ç»æœ‰äººå†™è¿‡ä¸€ä¸ªåŸºäºAPlayerçš„hexoæ’ä»¶ - <a href="https://github.com/grzhan/hexo-tag-aplayer" target="_blank" rel="external">hexo-tag-aplayer</a>ã€‚ä¸è¿‡çœ‹äº†åªèƒ½æ·»åŠ å•æ›²ï¼Œæ·»åŠ ä¸äº†ä¸“è¾‘æˆ–æ˜¯æ­Œå•ã€‚æ­£å¥½åˆšé‡å†™äº†æœç´¢çš„APIï¼Œæ„Ÿè§‰å¯ä»¥æä¸€æã€‚</p>
<p>æ’ä»¶ç”¨çš„æ˜¯åˆ©ç”¨äº†Hexoå¯ä»¥è‡ªå®šä¹‰æ ‡ç­¾æ’ä»¶è‡ªå®šä¹‰äº†æ­Œå•æ ‡ç­¾ã€‚<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">hexo.extend.tag.register(<span class="string">'aplayerlist'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> albumlist_id = args[<span class="number">0</span>], narrow = <span class="literal">false</span>, autoplay = <span class="literal">false</span>, width = <span class="string">''</span>,</div><div class="line">        id = <span class="string">'aplayer'</span> + (counter++), raw = <span class="string">''</span>, content = <span class="string">''</span>;</div><div class="line">    <span class="comment">// Parse optional arguments</span></div><div class="line">    <span class="keyword">if</span> (args.length &gt; <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">var</span> options = args.slice(<span class="number">1</span>);</div><div class="line">        narrow = options.indexOf(<span class="string">'narrow'</span>) &lt; <span class="number">0</span> ? <span class="literal">false</span> : <span class="literal">true</span>;</div><div class="line">        autoplay = options.indexOf(<span class="string">'autoplay'</span>) &lt; <span class="number">0</span> ? <span class="literal">false</span> : <span class="literal">true</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; options.length; i++) &#123;</div><div class="line">            <span class="keyword">var</span> option = options[i];</div><div class="line">            width = option.indexOf(<span class="string">'width:'</span>) == <span class="number">0</span> ? option + <span class="string">';'</span> : width;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    width = narrow ? <span class="string">''</span> : width;</div><div class="line">    <span class="keyword">var</span> album;</div><div class="line">    <span class="keyword">var</span> req = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">        req.open(<span class="string">'GET'</span>, <span class="string">"***/hexo_playlist.php?id="</span> + albumlist_id, <span class="literal">false</span>);</div><div class="line">        req.send();</div><div class="line">        <span class="keyword">if</span>(req.status === <span class="number">200</span>) &#123;</div><div class="line">            album = req.responseText;</div><div class="line">        &#125;</div><div class="line">        raw = <span class="string">'&lt;div id="'</span>+ id + <span class="string">'" class="aplayer" style="margin-bottom: 20px;display:inline-block;'</span>+ width + <span class="string">'"&gt;'</span>;</div><div class="line">        raw +=</div><div class="line">        <span class="string">'&lt;/div&gt;&lt;script&gt;var '</span>+ id + <span class="string">' = new APlayer(&#123;'</span>+</div><div class="line">                <span class="string">'element: document.getElementById("'</span>+ id +<span class="string">'"),'</span> +</div><div class="line">                <span class="string">'narrow: '</span> + (narrow ? <span class="string">'true'</span> : <span class="string">'false'</span>) + <span class="string">','</span> +</div><div class="line">                <span class="string">'autoplay: '</span> + (autoplay ? <span class="string">'true'</span> : <span class="string">'false'</span>) + <span class="string">','</span> +</div><div class="line">                <span class="string">'music : '</span> + album +</div><div class="line">            <span class="string">'&#125;);'</span> +</div><div class="line">        id + <span class="string">'.init();&lt;/script&gt;'</span>;</div><div class="line">    <span class="keyword">return</span> raw;</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>ç„¶ååœ¨mdæ–‡ä»¶ä¸­ä»¥<code><div id="aplayer0" class="aplayer" style="margin-bottom: 20px;display:inline-block;"></div><script>var aplayer0 = new APlayer({element: document.getElementById("aplayer0"),narrow: false,autoplay: false,music : 
Notice: Undefined index: album in /data/home/qxu1098560294/htdocs/wechat/hexo_api.php on line 66

Warning: Invalid argument supplied for foreach() in /data/home/qxu1098560294/htdocs/wechat/hexo_api.php on line 68
[]});aplayer0.init();</script></code>çš„æ ¼å¼å³å¯è°ƒç”¨ã€‚<br>å…¶ä¸­åªæœ‰<code>album_id</code>è¿™ä¸ªå‚æ•°æ˜¯å¿…é¡»çš„ï¼Œä¼ å…¥çš„æ˜¯ä¸“è¾‘çš„idï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¼ æ­Œå•idï¼Œåªè¦åœ¨å®ç°é‡Œé¢è°ƒæ­Œå•æœç´¢çš„APIå³å¯ã€‚åé¢çš„å‚æ•°éƒ½æ˜¯å¯é€‰çš„ã€‚</p>
<ul>
<li><code>narrow</code>æ˜¯å¦æ˜¾ç¤ºæ­Œæ›²åˆ—è¡¨ï¼Œé»˜è®¤éšè—</li>
<li><code>autoplay</code> æ˜¯å¦è‡ªåŠ¨æ’­æ”¾<br>é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥é…ç½®å¤§å°ï¼Œä¸è¿‡è¿™ä¸ªåœ°æ–¹æˆ‘ç›´æ¥è®¾äº†å›ºå®šçš„å®½åº¦ã€‚</li>
</ul>
<p>æ’ä»¶åŸæœ¬ä¸€ä¸ªæ ‡ç­¾åªèƒ½æ”¾ä¸€é¦–æ­Œï¼Œäºæ˜¯ä¹Ÿé‡å†™äº†ä¸‹<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">&#123;% aplayer [&#123;&#125;,&#123;&#125;]  [narrow, autoplay] %&#125;</div></pre></td></tr></table></figure></p>
<p>ä»¥æ•°ç»„çš„å½¢å¼ä¼ å…¥åŒ…å«æ¯é¦–æ­Œçš„ä¿¡æ¯çš„å¯¹è±¡å³å¯ï¼Œä»£ç å¦‚ä¸‹:<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">hexo.extend.tag.register(<span class="string">'aplayer'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> narrow = <span class="literal">false</span>, autoplay = <span class="literal">false</span>, width = <span class="string">''</span>,</div><div class="line">        id = <span class="string">'aplayer'</span> + (counter++), raw = <span class="string">''</span>, content = <span class="string">''</span>;</div><div class="line">    <span class="keyword">if</span> (args.length &gt; <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">var</span> options = args.slice(<span class="number">1</span>);</div><div class="line">        narrow = options.indexOf(<span class="string">'narrow'</span>) &lt; <span class="number">0</span> ? <span class="literal">false</span> : <span class="literal">true</span>;</div><div class="line">        autoplay = options.indexOf(<span class="string">'autoplay'</span>) &lt; <span class="number">0</span> ? <span class="literal">false</span> : <span class="literal">true</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; options.length; i++) &#123;</div><div class="line">            <span class="keyword">var</span> option = options[i];</div><div class="line">            width = option.indexOf(<span class="string">'width:'</span>) == <span class="number">0</span> ? option + <span class="string">';'</span> : width;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    width = narrow ? <span class="string">''</span> : width;</div><div class="line">    <span class="keyword">var</span> album = [];</div><div class="line">    <span class="keyword">var</span> data = <span class="built_in">eval</span>(args[<span class="number">0</span>]);</div><div class="line">    data.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">song</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> song_info = &#123;</div><div class="line">            <span class="attr">title</span>: song[<span class="number">0</span>],</div><div class="line">            <span class="attr">author</span>: song[<span class="number">1</span>],</div><div class="line">            <span class="attr">url</span>: song[<span class="number">2</span>],</div><div class="line">            <span class="attr">pic</span>: song[<span class="number">3</span>]</div><div class="line">        &#125;;</div><div class="line">    album.push(song_info);</div><div class="line">    &#125;);</div><div class="line">    raw = <span class="string">'&lt;div id="'</span>+ id + <span class="string">'" class="aplayer" style="margin-bottom: 20px;'</span>+ width + <span class="string">'"&gt;'</span>;</div><div class="line">    raw +=</div><div class="line">        <span class="string">'&lt;/div&gt;&lt;script&gt;var '</span>+ id + <span class="string">' = new APlayer(&#123;'</span>+</div><div class="line">                <span class="string">'element: document.getElementById("'</span>+ id +<span class="string">'"),'</span> +</div><div class="line">                <span class="string">'narrow: '</span> + (narrow ? <span class="string">'true'</span> : <span class="string">'false'</span>) + <span class="string">','</span> +</div><div class="line">                <span class="string">'autoplay: '</span> + (autoplay ? <span class="string">'true'</span> : <span class="string">'false'</span>) + <span class="string">','</span> +</div><div class="line">                <span class="string">'music : '</span> + <span class="built_in">JSON</span>.stringify(album) +</div><div class="line">            <span class="string">'&#125;);'</span> +</div><div class="line">        id + <span class="string">'.init();&lt;/script&gt;'</span>;</div><div class="line">    <span class="keyword">return</span> raw;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="3-å°ç»“"><a href="#3-å°ç»“" class="headerlink" title="[3] å°ç»“:"></a>[3] å°ç»“:</h3><p>æ’ä»¶æœ¬èº«æ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡ï¼Œåˆ©ç”¨äº†ä¹‹å‰å†™å¥½çš„æœç´¢æ¥å£ï¼Œè·å–åˆ°æ•°æ®åæŒ‰ç…§APlayerçš„æ ¼å¼ç”ŸæˆAPlayerå¯¹è±¡å³å¯ã€‚ä½†è¿˜æ˜¯å‡ºç°äº†ä¸¤ä¸ªå¾ˆè›‹ç–¼çš„äº‹æƒ…ï¼šä¸€ä¸ªæ˜¯ä»æ¥å£è·å–åˆ°æ•°æ®åçš„è½¬æ¢ï¼Œä¸€ä¸ªæ˜¯nodeä¸­çš„åŒæ­¥ajaxã€‚</p>
<h4 id="1-æ•°æ®è½¬æ¢"><a href="#1-æ•°æ®è½¬æ¢" class="headerlink" title="[1] æ•°æ®è½¬æ¢"></a>[1] æ•°æ®è½¬æ¢</h4><p>APlayeréŸ³ä¹ä¿¡æ¯éƒ¨åˆ†çš„æ•°æ®æ˜¯è¿™æ ·çš„<code>[{title:, url:,xxx:...},{title:, url:,xxx:...}]</code>ã€‚ä½†æ˜¯phpå¦‚æœç›´æ¥ä¼ æ•°ç»„è¿‡æ¥æ ¹æœ¬æ²¡æ³•ç”¨ï¼Œå› ä¸ºphpä¸­çš„æ•°ç»„æ˜¯è¿™æ ·çš„æ ¼å¼:<br><figure class="highlight php"><table><tr><td class="code"><pre><div class="line"><span class="keyword">array</span>(</div><div class="line">    [<span class="number">0</span>] =&gt; &#123;&#125;,</div><div class="line">    [<span class="number">1</span>] =&gt; &#123;&#125;</div><div class="line">    )</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·çš„ä¼ è¿‡æ¥æ ¹æœ¬æ²¡æ³•è§£æ(åº”è¯¥æ˜¯è§£æèµ·æ¥éº»çƒ¦)ã€‚jsonæ ¼å¼ä¹Ÿè¯•äº†ï¼Œåºåˆ—åŒ–çš„æ—¶å€™è¿˜æ˜¯å¸¦phpæ•°ç»„çš„é‚£ä¸€å¨ã€‚æ€æ¥æƒ³å»è¿˜æ˜¯å­—ç¬¦ä¸²é è°±ï¼Œè™½ç„¶æ‹¼å­—ç¬¦ä¸²å¾ˆçƒ¦ï¼Œä»¿ä½›åˆå›åˆ°äº†åç«¯æ¨¡æ¿çš„æ—¶ä»£ï¼Œä¸è¿‡ç¡®å®å¾ˆç®¡ç”¨ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">batch_get_song_info</span><span class="params">($album_id)</span></span></div><div class="line">&#123;</div><div class="line">    $result = json_decode(get_album_info($album_id), <span class="keyword">true</span>);</div><div class="line">    $result = $result[<span class="string">"album"</span>][<span class="string">"songs"</span>];</div><div class="line">    $song_list = <span class="string">"["</span>;</div><div class="line">    <span class="keyword">foreach</span> ($result <span class="keyword">as</span> $key =&gt; $song) &#123;</div><div class="line">        $result = json_decode(get_music_info($song[<span class="string">'id'</span>]), <span class="keyword">true</span>);</div><div class="line"></div><div class="line">        $result = $result[<span class="string">'songs'</span>][<span class="number">0</span>];</div><div class="line">        $info = <span class="string">"&#123;"</span>;</div><div class="line">        $music_name = $result[<span class="string">'name'</span>];</div><div class="line">        $artist_name = $result[<span class="string">'artists'</span>][<span class="number">0</span>][<span class="string">'name'</span>];</div><div class="line">        $music_url = $result[<span class="string">'mp3Url'</span>];</div><div class="line">        $music_pic = $result[<span class="string">'album'</span>][<span class="string">'picUrl'</span>];</div><div class="line">        $info .= <span class="string">"title:'"</span> .$music_name . <span class="string">"',author:'"</span> . $artist_name . <span class="string">"',url:'"</span> .$music_url . <span class="string">"',pic:'"</span> . $music_pic . <span class="string">"'&#125;,"</span>;</div><div class="line">        $song_list .= $info;</div><div class="line">    &#125;</div><div class="line">     $song_list = rtrim($song_list,<span class="string">","</span>);</div><div class="line">     $song_list .= <span class="string">"]"</span>;</div><div class="line">     <span class="keyword">return</span> $song_list;</div><div class="line">&#125;</div><div class="line"><span class="comment">// example</span></div><div class="line">$album_id = $_GET[<span class="string">'id'</span>];</div><div class="line">$result = get_album_detail($album_id);</div><div class="line">print_r($result);</div></pre></td></tr></table></figure>
<p>å‡ºå…¥ä¸“è¾‘idä¹‹åget_album_infoè·å–ä¸“è¾‘å†…æ‰€æœ‰æ­Œæ›²çš„id(ä¸å¾—ä¸ä½©æœè€ä¸œå®¶ï¼Œäº‘éŸ³ä¹çš„å¤§éƒ¨åˆ†APIéƒ½æ— æ³•ä¸€æ¬¡å¾—åˆ°ä½ æƒ³è¦çš„æ‰€æœ‰æ•°æ®,å½“æ—¶MVå’Œæ­Œå•é‚£å—è¿˜æ˜¯æˆ‘å†™çš„å‘¢ï¼Œå”‰â€¦)ï¼Œç„¶åç”¨get_music_infoæŒ¨ä¸ªæœä¸€éï¼Œæœ€åå°±æ˜¯è›‹ç–¼çš„æ‹¼å­—ç¬¦ä¸²ã€‚</p>
<h4 id="2-nodeä¸­çš„åŒæ­¥è¯·æ±‚"><a href="#2-nodeä¸­çš„åŒæ­¥è¯·æ±‚" class="headerlink" title="[2] nodeä¸­çš„åŒæ­¥è¯·æ±‚"></a>[2] nodeä¸­çš„åŒæ­¥è¯·æ±‚</h4><p>ä¸€å¼€å§‹æƒ³ç”¨é«˜å¤§ä¸Šçš„fetchï¼Œä½†æ˜¯fetchå¥½åƒæ²¡æ³•åŒæ­¥è¯·æ±‚ï¼Œè¯•äº†ä¸€å¤§æ¨å…¶ä»–çš„æ¨¡å—ï¼Œæœ€åè¿˜æ˜¯å›åˆ°äº†æˆ‘ç†Ÿæ‚‰çš„xhr<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// xmlhttprequest nodeä¸­çš„XHRæ¨¡å—</span></div><div class="line">    XMLHttpRequest = <span class="built_in">require</span>(<span class="string">"xmlhttprequest"</span>).XMLHttpRequest;</div><div class="line">    <span class="keyword">var</span> album, req = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">        req.open(<span class="string">'GET'</span>, <span class="string">"http://bgm.iminyao.com/wechat/hexo_playlist.php?id="</span> + albumlist_id, <span class="literal">false</span>);</div><div class="line">        req.send();</div><div class="line">        <span class="keyword">if</span>(req.status === <span class="number">200</span>) &#123;</div><div class="line">            album = req.responseText;</div><div class="line">        &#125;</div></pre></td></tr></table></figure></p>
<p>ç†Ÿæ‚‰çš„æ„Ÿè§‰ï¼Œè¿˜æ˜¯åŸæ¥å‘³é“ã€‚</p>
<p>è¿™è¿˜ä¸æ˜¯å…³é”®ï¼Œå…³é”®æ˜¯å‘ç°è‡ªå·±å¯¹è¯·æ±‚è¿™å—è¿˜ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼ŒåŒ…æ‹¬XMLHttpRequestï¼Œæ›´åˆ«è¯´fetchäº†ï¼Œç‰¹åˆ«æ˜¯æ•°æ®ç±»å‹è¿™ä¸€å—ï¼Œå›å¤´å¾—å¥½å¥½æ€»ç»“ä¸€ä¸‹ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªå¤§å½©è›‹ï¼Œå†™å®Œäº†å¾€åšå®¢ä¸Šæ·»ä¸“è¾‘çš„æ—¶å€™æ‰æƒ³èµ·æ¥ï¼Œè™¾ç±³å„æ–­äº†æ»šçŸ³çš„ç‰ˆæƒï¼Œå°æçš„éŸ³ä¹åŒ…æ‹¬ã€Šç†æ€§ä¸æ„Ÿæ€§ä½œå“éŸ³ä¹ä¼šã€‹åŸºæœ¬ä¸Šéƒ½è·ªäº†ã€‚æœ€è›‹ç–¼çš„æ˜¯é€šè¿‡APIè¿˜èƒ½æœåˆ°éŸ³ä¹èµ„æºï¼Œä½†æ˜¯èµ„æºå·²ç»å¤±æ•ˆâ€¦ä¸“è¾‘æœç´¢çš„æ¥å£å°±æ˜¯è¿™ä¹ˆç©çš„ï¼Œæ•°æ®é‡Œé¢æœ‰MP3é“¾æ¥ï¼Œä½†æ˜¯å…¨éƒ¨æ˜¯404â€¦è¿™ä¸ªé—®é¢˜å¾…è§£å†³ã€‚</p>
<p>æœ‰é’±çœŸå¥½ï¼Œé©¬äº‘çˆ¸çˆ¸ï¼Œè¯·æ”¶ä¸‹æˆ‘çš„è†ç›–ğŸ˜­</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://vino24.cn/2016/10/31/wechat-music-serach-module-update/" data-id="cixa9popn008oearn2pgiwjsb" class="article-share-link">åˆ†äº«åˆ°</a><div class="tags"></div><div class="post-nav"><a href="/2016/11/01/hexo-basic/" class="pre">hexoå¸¸ç”¨é…ç½®ä¸€è§ˆ</a><a href="/2016/10/27/three.js-first/" class="next">three.jså…¥é—¨</a></div><div data-thread-key="2016/10/31/wechat-music-serach-module-update/" data-title="å¾®ä¿¡ç‚¹æ­Œæ¨¡å—ä»£ç æ›´æ–°åŠhexoéŸ³ä¹æ’ä»¶" data-url="http://vino24.cn/2016/10/31/wechat-music-serach-module-update/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">åˆ†äº«åˆ°ï¼š</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">å¾®åš</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQç©ºé—´</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">è…¾è®¯å¾®åš</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">å¾®ä¿¡</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/10/31/wechat-music-serach-module-update/" data-title="å¾®ä¿¡ç‚¹æ­Œæ¨¡å—ä»£ç æ›´æ–°åŠhexoéŸ³ä¹æ’ä»¶" data-url="http://vino24.cn/2016/10/31/wechat-music-serach-module-update/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IE/">IE</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript-API/">JavaScript API</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript-Framework/">JavaScript Framework</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile-Develop/">Mobile Develop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Performance-Optimize/">Performance Optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Requirements-Daily/">Requirements&&Daily</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/devTools-Configuration/">devTools&&Configuration</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/åˆ‡å›¾/">åˆ‡å›¾</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/æ€»ç»“/">æ€»ç»“</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/éšç¬”/">éšç¬”</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/Ajax/" style="font-size: 15px;">Ajax</a> <a href="/tags/CSS-Layout/" style="font-size: 15px;">CSS Layout</a> <a href="/tags/CSS-Core/" style="font-size: 15px;">CSS Core</a> <a href="/tags/CSS-Collection/" style="font-size: 15px;">CSS Collection</a> <a href="/tags/DOM/" style="font-size: 15px;">DOM</a> <a href="/tags/CSS-core/" style="font-size: 15px;">CSS core</a> <a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/JavaScript-Core/" style="font-size: 15px;">JavaScript Core</a> <a href="/tags/bind/" style="font-size: 15px;">bind</a> <a href="/tags/PS/" style="font-size: 15px;">PS</a> <a href="/tags/æ€§èƒ½ä¼˜åŒ–/" style="font-size: 15px;">æ€§èƒ½ä¼˜åŒ–</a> <a href="/tags/avalon-js/" style="font-size: 15px;">avalon.js</a> <a href="/tags/JavaScript-API/" style="font-size: 15px;">JavaScript API</a> <a href="/tags/Flex/" style="font-size: 15px;">Flex</a> <a href="/tags/å†…å­˜æ³„æ¼/" style="font-size: 15px;">å†…å­˜æ³„æ¼</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Netease-Weekly/" style="font-size: 15px;">Netease Weekly</a> <a href="/tags/react-js/" style="font-size: 15px;">react.js</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/this/" style="font-size: 15px;">this</a> <a href="/tags/three-js/" style="font-size: 15px;">three.js</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/Tips/" style="font-size: 15px;">Tips</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€æ–°æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/12/08/es6-spread-rest/">ES6 spreadå’Œrest operator</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/08/react-form/">reactä¸­çš„è¡¨å•</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/06/github-tip/">githubå®ç”¨æŠ€å·§</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/02/react-first/">react.jså…¥é—¨</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/28/avalon-first-md/">avalon.jså…¥é—¨</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/22/chrome-dev-tools-console/">Chrome Dev Toolsä½¿ç”¨æŠ€å·§æ€»ç»“(ä¸€) Console</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/02/fetch-api/">Fetch API</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/01/hexo-basic/">hexoå¸¸ç”¨é…ç½®ä¸€è§ˆ</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/31/wechat-music-serach-module-update/">å¾®ä¿¡ç‚¹æ­Œæ¨¡å—ä»£ç æ›´æ–°åŠhexoéŸ³ä¹æ’ä»¶</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/27/three.js-first/">three.jså…¥é—¨</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> æœ€è¿‘è¯„è®º</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="http://bgm.iminyao.com/" title="èƒŒæ™¯éŸ³ä¹" target="_blank">èƒŒæ™¯éŸ³ä¹</a><ul></ul><a href="http://weibo.com/jzwmxz" title="æ°‘è°£ä¹‹å®¶" target="_blank">æ°‘è°£ä¹‹å®¶</a><ul></ul><a href="http://www.zhihu.com/people/iminyao" title="é€¢åå€Ÿä¸€" target="_blank">é€¢åå€Ÿä¸€</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Â© <a href="/." rel="nofollow">é€¢åå€Ÿä¸€.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"></a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'vino24'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>