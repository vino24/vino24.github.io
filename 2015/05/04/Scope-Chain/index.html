<!DOCTYPE html>
<html>
    <head>
    <!-- Title -->
    
    <title>
        JavaScript作用域链 | 逢十借一
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/apple-touch-icon.png">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    <link rel="manifest" href="manifest.json">
    <!-- Meta & INfo -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="vino24">
    <meta name="description" content="web前端开发, 前端开发工程师, 前端开发攻城师, 前端资源, CSS, JavaScript, HTML, Web标准">
    <meta name="keywords" content="web前端开发, 前端开发工程师, 前端开发攻城师, 前端资源, CSS, JavaScript, HTML, Web标准">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="逢十借一">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://vino24.cn">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="JavaScript作用域链 | 逢十借一">
    <meta property="og:description" content="web前端开发, 前端开发工程师, 前端开发攻城师, 前端资源, CSS, JavaScript, HTML, Web标准">

     <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
	body, html{
		font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
	}
	
    a{
        color: #00838F
    }
    
    .mdl-card__media,
    #search-label,
    #search-form-label:after,
    #scheme-Paradox .hot_tags-count,
    #scheme-Paradox .sidebar_archives-count,
    #scheme-Paradox .sidebar-colored .sidebar-header,
    #scheme-Paradox .sidebar-colored .sidebar-badge{
        background-color: #0097A7 !important
    }
    
	/* Sidebar User Drop Down Menu Text Color */
	#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus{
        color: #0097A7 !important
    }
    
    #post_entry-right-info,
    .sidebar-colored .sidebar-nav li:hover > a,
    .sidebar-colored .sidebar-nav li:hover > a i,
    .sidebar-colored .sidebar-nav li > a:hover,
    .sidebar-colored .sidebar-nav li > a:hover i,
    .sidebar-colored .sidebar-nav li > a:focus i,
    .sidebar-colored .sidebar-nav > .open > a,
    .sidebar-colored .sidebar-nav > .open > a:hover,
    .sidebar-colored .sidebar-nav > .open > a:focus,
    #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a{
        color: #0097A7 !important
    }
    
    .toTop{
        background: #757575 !important
    }
		
	.material-layout .material-post>.material-nav,
	.material-layout .material-index>.material-nav,
	.material-nav a{
		color: #757575;
	}
		
	#scheme-Paradox .MD-burger-layer {
		background-color: #757575;
	}

	#scheme-Paradox #post-toc-trigger-btn{
		color: #757575;
	}
	
	.post-toc a:hover{
		color: #00838F;
		text-decoration: underline;
	}
</style>


<!-- Theme Background Related-->

	<style>
		body{
            background-image: url(https://api.i-meto.com/bing?new);
        }
	</style>




<!-- Fade Effect -->

    <style>
        .fade {
            transition: all 800ms linear;
            -webkit-transform: translate3d(0,0,0);
            -moz-transform: translate3d(0,0,0);
            -ms-transform: translate3d(0,0,0);
            -o-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
            opacity: 1;
        }

        .fade.out{
            opacity: 0;
        }
    </style>

	<script src="/js/jquery.min.js"></script>

	<link rel="stylesheet" href="/css/highlight/solarized-white.css">

	<!-- UC Browser Compatible-->
	<script>
		var agent = navigator.userAgent.toLowerCase();
		if(agent.indexOf('ucbrowser')>0) {
			document.write('<link rel="stylesheet" href="/css/uc.css">');
		   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
		}
	</script>

    <!-- Custom Head -->
    
</head>


	

    <body id="scheme-Paradox">


        <div class="material-layout  mdl-js-layout has-drawer is-upgraded">

			

            <!-- Main Container -->
            <main class="material-layout__content" id="main">

                <!-- Top Anchor -->
                <div id="top"></div>

				
                <!-- Hamburger Button -->
                <button class="MD-burger-icon sidebar-toggle">
                    <span class="MD-burger-layer"></span>
                </button>
				

                <!-- Post TOC -->

    
	<!-- Back Button -->
<!--
	<div class="material-back" id="backhome-div" tabindex="0">
		<a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" href="#" onclick="window.history.back();return false;" target="_self" role="button" data-upgraded=",MaterialButton,MaterialRipple">
			<i class="material-icons" role="presentation">arrow_back</i>
			<span class="mdl-button__ripple-container">
				<span class="mdl-ripple"></span>
			</span>
		</a>
	</div>			
-->
	<!-- Left aligned menu below button -->
	<button id="post-toc-trigger-btn"
			class="mdl-button mdl-js-button mdl-button--icon">
	  <i class="material-icons">format_list_numbered</i>
	</button>

	<ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect"
		for="post-toc-trigger-btn">
			
			<ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#目录："><span class="post-toc-number">1.</span> <span class="post-toc-text">目录：</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#eg-1-javascript-执行环境，变量对象，作用域链"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">eg_1 javascript 执行环境，变量对象，作用域链</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#eg-1-1"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">eg_1.1</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#eg1-2"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">eg1.2</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#eg-2-Javascript作用域原理"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">eg_2: Javascript作用域原理</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#过程："><span class="post-toc-number">1.5.</span> <span class="post-toc-text">过程：</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#eg-3-JavaScript作用域链"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">eg_3: JavaScript作用域链</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#eg-4-JavaScript-开发进阶：理解-JavaScript-作用域和作用域链"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">eg_4: JavaScript 开发进阶：理解 JavaScript 作用域和作用域链</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#参考："><span class="post-toc-number">2.</span> <span class="post-toc-text">参考：</span></a></li></ol>
		
<!--			<li class="mdl-menu__item">Some Action</li>-->
	</ul>



<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">
		
        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
	<!-- Paradox Post Header -->
	
		
			<!-- Random Thumbnail -->
			<div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
				<script>
    
    var randomNum;
    randomNum = Math.floor(Math.random() * 5 + 1);
    
    $(".post_thumbnail-random").css('background-image', 'url(' + '/img/random/' + randomNum + '.png' + ')');
    
</script>

		
	
        <p class="article-headline-p">
            JavaScript作用域链
        </p>
    </div>

	

				
				
					<!-- Paradox Post Info -->
					<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
    
    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>vino24</strong>
        <span>5月 04, 2015</span>
    </div>
    
    <div class="section-spacer"></div>
	
    <!-- Favorite -->
<!--
    <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
        <i class="material-icons" role="presentation">favorite</i>
        <span class="visuallyhidden">favorites</span>
    </button>
-->
    
    <!-- Tags (bookmark) -->
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/JavaScript-Core/">JavaScript Core</a>
    </ul>
    
    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    
    
    
    
    <!-- Share Twitter -->
    <a class="post_share-link" href="https://twitter.com/intent/tweet?text=JavaScript作用域链&url=http://vino24.cn//2015/05/04/Scope-Chain/index.html&via=vino24" target="_blank">
        <li class="mdl-menu__item">
            分享到 Twitter
        </li>
    </a>
    
    <!-- Share Google+ -->
    <a class="post_share-link" href="https://plus.google.com/share?url=http://vino24.cn//2015/05/04/Scope-Chain/index.html" target="_blank">
        <li class="mdl-menu__item">
            分享到 Google+
        </li>
    </a>
    
    <!-- Share Weibo -->
    <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=JavaScript作用域链&url=http://vino24.cn//2015/05/04/Scope-Chain/index.html&pic=&searchPic=false&style=simple" target="_blank">
        <li class="mdl-menu__item">
            分享到微博
        </li>
    </a>
</ul>
</div>
				

                <!-- Post Content -->
                <div id="post-content" class="markdown-Github mdl-color-text--grey-700 mdl-card__supporting-text fade out">
	
		<script src="/assets/js/APlayer.min.js"> </script><h3 id="目录："><a href="#目录：" class="headerlink" title="目录："></a>目录：</h3><ul>
<li>EC(执行环境或者执行上下文，Execution Context)</li>
</ul>
<blockquote>
<p>执行代码时会创建一个称为“执行上下文(execution context)”的内部对象，执行上下文定义了函数执行时的环境。每个执行上下文都有自己的作用域链，用于标识符解析，当执行上下文被创建时，它的作用域链初始化为当前运行函数的[[Scope]]所包含的对象。每个执行环境都有一个与之关联的变量对象（variable object, VO）</p>
</blockquote>
<p>javascript中，EC分为三种：</p>
<ul>
<li>全局级别的代码 – 这个是默认的代码运行环境，一旦代码被载入，引擎最先进入的就是这个环境。</li>
<li>函数级别的代码 – 当执行一个函数时，运行函数体中的代码。</li>
<li>Eval的代码 – 在Eval函数内运行的代码。</li>
</ul>
<p>EC建立分为两个阶段：进入执行上下文和执行阶段。</p>
<p>1.进入上下文阶段：发生在函数调用时，但是在执行具体代码之前（比如，对函数参数进行具体化之前）<br>2.执行代码阶段：变量赋值，函数引用，执行其他代码。</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><div class="line">EC=&#123;</div><div class="line"><span class="symbol">    VO:</span>&#123;<span class="comment">/* 函数中的arguments对象, 参数, 内部的变量以及函数声明 */</span>&#125;,</div><div class="line"><span class="symbol">    this:</span>&#123;&#125;,</div><div class="line"><span class="symbol">    Scope:</span>&#123; <span class="comment">/* VO以及所有父执行上下文中的VO */</span>&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ECS(执行环境栈Execution Context Stack)</li>
</ul>
<blockquote>
<p>一系列活动的执行上下文从逻辑上形成一个栈。每个函数都有自己的执行环境，当执行流进入一个函数的时候，函数的环境会被推入ECS中，而在函数执行完毕后执行环境出栈并被销毁，保存在其中的所有变量和函数定义随之销毁，控制权返回到之前的执行环境中，全局的执行环境在应用程序退出（浏览器关闭）才会被销毁。<br>栈底总是全局上下文，栈顶是当前（活动的）执行上下文。当在不同的执行上下文间切换（退出的而进入新的执行上下文）的时候，栈会被修改（通过压栈或者退栈的形式）。</p>
</blockquote>
<ol>
<li>压栈：全局EC–&gt;局部EC1–&gt;局部EC2–&gt;当前EC</li>
<li>出栈：全局EC&lt;–局部EC1&lt;–局部EC2&lt;–当前EC<figure class="highlight ebnf"><table><tr><td class="code"><pre><div class="line"><span class="attribute">ECS</span>=[局部EC,全局EC];</div></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>VO(变量对象，Variable Object)</li>
</ul>
<blockquote>
<p>每个执行环境都有一个与之关联的变量对象（variable object, VO）在该EC中定义的所有变量和函数都存放在其对应的VO中，解析器在处理数据的时候就会访问这个内部对象</p>
</blockquote>
<figure class="highlight ada"><table><tr><td class="code"><pre><div class="line">VO: &#123;</div><div class="line">  // 上下文中的数据 (变量声明（var）, 函数声明（FD), 函数形参（<span class="keyword">function</span> <span class="title">arguments）)</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>进入执行上下文时，VO的初始化过程具体如下：</li>
</ol>
<ul>
<li><p>函数的形参（当进入函数执行上下文时）<br>—— 变量对象的一个属性，其属性名就是形参的名字，其值就是实参的值；对于没有传递的参数，其值为undefined</p>
</li>
<li><p>函数声明（FunctionDeclaration, FD） —— 变量对象的一个属性，其属性名和值都是函数对象创建出来的；如果变量对象已经包含了相同名字的属性，则替换它的值</p>
</li>
<li><p>变量声明（var，VariableDeclaration） —— 变量对象的一个属性，其属性名即为变量名，其值为undefined;如果变量名和已经声明的函数名或者函数的参数名相同，则不会影响已经存在的属性。</p>
</li>
</ul>
<ol>
<li>执行代码阶段时，VO中的一些属性undefined值将会确定。</li>
</ol>
<ul>
<li>AO(活动对象，Active Object)</li>
</ul>
<blockquote>
<p>AO是在进入函数的执行上下文时创建的，并为该对象初始化一个arguments属性，该属性的值为Arguments对象。<br>在一个函数对象被调用的时候，会创建一个活动对象(也就是一个对象), 然后对于每一个函数的形参，都命名为该活动对象的命名属性, 然后将这个活动对象做为此时的作用域链(scope chain)最前端, 并将这个函数对象的[[scope]]加入到scope chain中</p>
</blockquote>
<figure class="highlight dts"><table><tr><td class="code"><pre><div class="line">AO = &#123;</div><div class="line"><span class="symbol">  arguments:</span> &#123;</div><div class="line"><span class="symbol">    callee:</span>,</div><div class="line"><span class="symbol">    length:</span>,</div><div class="line">    properties-indexes: <span class="comment">//函数传参参数值</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="eg-1-javascript-执行环境，变量对象，作用域链"><a href="#eg-1-javascript-执行环境，变量对象，作用域链" class="headerlink" title="eg_1 javascript 执行环境，变量对象，作用域链"></a>eg_1 <a href="http://segmentfault.com/a/1190000000533094" target="_blank" rel="external">javascript 执行环境，变量对象，作用域链</a></h4><figure class="highlight abnf"><table><tr><td class="code"><pre><div class="line">alert(x)<span class="comment">; // function</span></div><div class="line"></div><div class="line">var x = <span class="number">10</span><span class="comment">;</span></div><div class="line">alert(x)<span class="comment">; // 10</span></div><div class="line"></div><div class="line"><span class="attribute">x</span> = <span class="number">20</span><span class="comment">;</span></div><div class="line"></div><div class="line">function x() &#123;&#125;<span class="comment">;</span></div><div class="line"></div><div class="line">alert(x)<span class="comment">; // 20</span></div></pre></td></tr></table></figure>
<p>进入执行上下文时，<br><figure class="highlight applescript"><table><tr><td class="code"><pre><div class="line">ECObject=&#123;</div><div class="line">  VO:&#123;</div><div class="line">    x:&lt;<span class="keyword">reference</span> <span class="keyword">to</span> FunctionDeclaration <span class="string">"x"</span>&gt;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>执行代码时：<br><figure class="highlight dts"><table><tr><td class="code"><pre><div class="line">ECObject=&#123;</div><div class="line"><span class="symbol">  VO:</span>&#123;</div><div class="line"><span class="symbol">    x:</span><span class="number">20</span> <span class="comment">//与函数x同名，替换掉，先是10，后变成20</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>在进入上下文的时候，VO会被填充函数声明； 同一阶段，还有变量声明“x”，但是，正如此前提到的，变量声明是在函数声明和函数形参之后，并且，变量声明不会对已经存在的同样名字的函数声明和函数形参发生冲突。</p>
</blockquote>
<h4 id="eg-1-1"><a href="#eg-1-1" class="headerlink" title="eg_1.1"></a>eg_1.1</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a, b</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> c = <span class="number">10</span>;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">  <span class="keyword">var</span> e = <span class="function"><span class="keyword">function</span> <span class="title">_e</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">  (<span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>) </span>&#123;&#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">test(<span class="number">10</span>); <span class="comment">// call</span></div></pre></td></tr></table></figure>
<p>当进入test(10)的执行上下文时，它的AO为：<br><figure class="highlight dts"><table><tr><td class="code"><pre><div class="line">testEC=&#123;</div><div class="line"><span class="symbol">    AO:</span>&#123;</div><div class="line"><span class="symbol">        arguments:</span>&#123;</div><div class="line"><span class="symbol">            callee:</span>test</div><div class="line"><span class="symbol">            length:</span><span class="number">1</span>,</div><div class="line">            <span class="number">0</span>:<span class="number">10</span></div><div class="line">        &#125;,</div><div class="line"><span class="symbol">        a:</span><span class="number">10</span>,</div><div class="line"><span class="symbol">        c:</span>undefined,</div><div class="line"><span class="symbol">        d:</span><span class="params">&lt;reference to FunctionDeclaration "d"&gt;</span>,</div><div class="line"><span class="symbol">        e:</span>undefined</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>在建立阶段，VO除了arguments，函数的声明，以及参数被赋予了具体的属性值，其它的变量属性默认的都是undefined。函数表达式不会对VO造成影响，因此，(function x() {})并不会存在于VO中。</p>
</blockquote>
<p>当执行test(10)时，它的AO为：<br><figure class="highlight dts"><table><tr><td class="code"><pre><div class="line">testEC=&#123;</div><div class="line"><span class="symbol">    AO:</span>&#123;</div><div class="line"><span class="symbol">        arguments:</span>&#123;</div><div class="line"><span class="symbol">            callee:</span>test,</div><div class="line"><span class="symbol">            length:</span><span class="number">1</span>,</div><div class="line">            <span class="number">0</span>:<span class="number">10</span></div><div class="line">        &#125;,</div><div class="line"><span class="symbol">        a:</span><span class="number">10</span>,</div><div class="line"><span class="symbol">        c:</span><span class="number">10</span>,</div><div class="line"><span class="symbol">        d:</span><span class="params">&lt;reference to FunctionDeclaration "d"&gt;</span>,</div><div class="line"><span class="symbol">        e:</span><span class="params">&lt;reference to FunctionDeclaration "e"&gt;</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<ul>
<li>作用域</li>
</ul>
<blockquote>
<p>作用域就是变量和函数的可访问范围，控制着变量和函数的可见性与生命周期，在JavaScript中变量的作用域有全局作用域和局部作用域。</p>
</blockquote>
<ul>
<li>[[scope]]属性</li>
</ul>
<blockquote>
<p>在JavaScript中，函数也是对象，实际上，JavaScript里一切都是对象。函数对象和其它对象一样，拥有可以通过代码访问的属性和一系列仅供JavaScript引擎访问的内部属性。其中一个内部属性是[[Scope]]，该内部属性包含了函数被创建的作用域中对象的集合，这个集合被称为函数的作用域链，它决定了哪些数据能被函数访问。</p>
<p>[[Scope]]是一个包含了所有上层变量对象的分层链，它属于当前函数上下文，并在函数创建的时候，保存在函数中。</p>
<p>[[Scope]]是在函数创建的时候保存起来的——静态的（不变的），只有一次并且一直都存在——直到函数销毁。</p>
</blockquote>
<h4 id="eg1-2"><a href="#eg1-2" class="headerlink" title="eg1.2"></a>eg1.2</h4><figure class="highlight actionscript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> x=<span class="number">10</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span><span class="params">()</span></span>&#123;</div><div class="line">  <span class="keyword">var</span> y=<span class="number">20</span>;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f2</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> x+y;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上示例中，f2的[[scope]]属性可以表示如下：<br><figure class="highlight lua"><table><tr><td class="code"><pre><div class="line">f2.<span class="string">[[scope]]</span>=[</div><div class="line">  f2OuterContext.VO</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>而f2的外部EC的所有上层变量对象包括了f1的活跃对象f1Context.AO，再往外层的EC，就是global对象了。<br>所以，具体我们可以表示如下：<br><figure class="highlight lua"><table><tr><td class="code"><pre><div class="line">f2.<span class="string">[[scope]]</span>=[</div><div class="line">  f1Context.AO,</div><div class="line">  globalContext.VO</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>对于EC执行环境是函数来说，那么它的Scope表示为：<br><figure class="highlight matlab"><table><tr><td class="code"><pre><div class="line">functionContext.Scope=functionContext.AO+<span class="function"><span class="keyword">function</span>.<span class="params">[[scope]</span>]</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>以上代码的表示，也体现了[[scope]]和Scope的差异，Scope是EC的属性，而[[scope]]则是函数的静态属性。</p>
</blockquote>
<p>对于以上的代码EC，我们可以给出其Scope的表示：<br><figure class="highlight lua"><table><tr><td class="code"><pre><div class="line">exampelEC=&#123;</div><div class="line">  Scope:[</div><div class="line">    f2Context.AO+f2.<span class="string">[[scope]]</span>,</div><div class="line">    f1.context.AO+f1.<span class="string">[[scope]]</span>,</div><div class="line">    globalContext.VO</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>scope chain(作用域链)</li>
</ul>
<blockquote>
<p>在执行上下文的作用域中查找变量的过程被称为标识符解析(indentifier resolution)，这个过程的实现依赖于函数内部另一个同执行上下文相关联的对象——作用域链。作用域链是一个有序链表，其包含着用以告诉JavaScript解析器一个标识符到底关联着哪一个变量的对象。而每一个执行上下文都有其自己的作用域链。</p>
<p>作用域链其实就是对执行上下文EC中的变量对象VO|AO有序访问的链表。能按顺序访问到VO|AO，就能访问到其中存放的变量和函数的定义。</p>
</blockquote>
<figure class="highlight lua"><table><tr><td class="code"><pre><div class="line">Scope chain = AO|VO + <span class="string">[[Scope]]</span></div></pre></td></tr></table></figure>
<ul>
<li>在一个函数被定义的时候, 会将它定义时刻的scope chain链接到这个函数对象的[[scope]]属性.</li>
<li>在一个函数对象被调用的时候，会创建一个活动对象(也就是一个对象), 然后对于每一个函数的形参，都命名为该活动对象的命名属性, 然后将这个活动对象做为此时的作用域链(scope chain)最前端, 并将这个函数对象的[[scope]]加入到scope chain中</li>
</ul>
<h4 id="eg-2-Javascript作用域原理"><a href="#eg-2-Javascript作用域原理" class="headerlink" title="eg_2: Javascript作用域原理"></a>eg_2: <a href="http://www.laruence.com/2009/05/28/863.html" target="_blank" rel="external">Javascript作用域原理</a></h4><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> <span class="function"><span class="keyword">func</span> = <span class="title">function</span><span class="params">(lps, rps)</span></span>&#123;</div><div class="line">          <span class="keyword">var</span> name = <span class="string">'laruence'</span>;</div><div class="line">          ........</div><div class="line">     &#125;</div><div class="line">     <span class="function"><span class="keyword">func</span><span class="params">()</span>;</span></div></pre></td></tr></table></figure>
<h4 id="过程："><a href="#过程：" class="headerlink" title="过程："></a>过程：</h4><ol>
<li>在执行func的定义语句的时候, 会创建一个这个函数对象的[[scope]]属性 并将这个[[scope]]属性, 链接到定义它的作用域链上, 此时因为func定义在全局环境, 所以此时的[[scope]]只是指向全局活动对象window active object.</li>
<li>在调用func的时候, 会创建一个活动对象(假设为aObj, 由JS引擎预编译时刻创建)，并创建arguments属性, 然后会给这个对象添加俩个命名属性aObj.lps, aObj.rps; 对于每一个在这个函数中申明的局部变量和函数定义, 都作为该活动对象的同名命名属性.</li>
<li>然后将调用参数赋值给形参数，对于缺少的调用参数，赋值为undefined</li>
<li>然后将这个活动对象做为scope chain的最前端, 并将func的[[scope]]属性所指向的定义func时候的顶级活动对象, 加入到scope chain.</li>
</ol>
<p><img src="/images/scope-chain-2016-08-04.jpeg" alt="pic1"></p>
<h4 id="eg-3-JavaScript作用域链"><a href="#eg-3-JavaScript作用域链" class="headerlink" title="eg_3: JavaScript作用域链"></a>eg_3: <a href="http://www.cnblogs.com/dolphinX/p/3280876.html" target="_blank" rel="external">JavaScript作用域链</a></h4><figure class="highlight actionscript"><table><tr><td class="code"><pre><div class="line"><span class="comment">//在函数a创建的时候它的作用域链填入全局对象,全局对象中有所有全局变量</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span><span class="params">(x,y)</span></span>&#123;</div><div class="line">            <span class="keyword">var</span> b=x+y;</div><div class="line">            <span class="keyword">return</span> b;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p><img src="http://images.cnitblog.com/blog/349217/201308/25155221-c777cdb6d3b24dd5972f65e4d262f90a.png" alt="pic2"><br><figure class="highlight ebnf"><table><tr><td class="code"><pre><div class="line"><span class="attribute">var tatal</span>=a(5,10);</div></pre></td></tr></table></figure></p>
<p>var total=a(5,10);语句的作用域链如下<br><img src="http://images.cnitblog.com/blog/349217/201308/25155227-d0d657caeeea4021ad4d51164fea6ed4.png" alt="pic3"></p>
<h4 id="eg-4-JavaScript-开发进阶：理解-JavaScript-作用域和作用域链"><a href="#eg-4-JavaScript-开发进阶：理解-JavaScript-作用域和作用域链" class="headerlink" title="eg_4: JavaScript 开发进阶：理解 JavaScript 作用域和作用域链"></a>eg_4: <a href="http://www.cnblogs.com/lhb25/archive/2011/09/06/javascript-scope-chain.html" target="_blank" rel="external">JavaScript 开发进阶：理解 JavaScript 作用域和作用域链</a></h4><p>当一个函数创建后，它的作用域链会被创建此函数的作用域中可访问的数据对象填充。例如定义下面这样一个函数：<br><figure class="highlight scilab"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(num1,num2)</span> &#123;</span></div><div class="line">    var <span class="built_in">sum</span> = num1 + num2;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在函数add创建时，它的作用域链中会填入一个全局对象，该全局对象包含了所有全局变量<br><img src="http://pic002.cnblogs.com/images/2011/36987/2011090414435366.jpg" alt="pic4"><br>函数add的作用域将会在执行时用到。<br><code>var total = add(5,10);</code><br>这些值按照它们出现在函数中的顺序被复制到运行期上下文的作用域链中。它们共同组成了一个新的对象，叫“活动对象(activation object)”，该对象包含了函数的所有局部变量、命名参数、参数集合以及this，然后此对象会被推入作用域链的前端，当运行期上下文被销毁，活动对象也随之销毁。新的作用域链如下图所示：<br><img src="http://pic002.cnblogs.com/images/2011/36987/2011090414444843.jpg" alt="pic5"></p>
<h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><ul>
<li><a href="http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html" target="_blank" rel="external">学习Javascript闭包（Closure）</a></li>
<li><a href="http://blog.jobbole.com/81011/" target="_blank" rel="external">作用域链相关的问题</a></li>
<li><a href="http://weizhifeng.net/javascript-the-core.html" target="_blank" rel="external">JavaScript核心</a></li>
<li><a href="http://segmentfault.com/a/1190000000533094" target="_blank" rel="external">javascript 执行环境，变量对象，作用域链</a></li>
<li><a href="http://www.laruence.com/2009/05/28/863.html" target="_blank" rel="external">Javascript作用域原理</a></li>
<li><a href="http://www.cnblogs.com/dolphinX/p/3280876.html" target="_blank" rel="external">JavaScript作用域链</a></li>
<li><a href="http://www.cnblogs.com/lhb25/archive/2011/09/06/javascript-scope-chain.html" target="_blank" rel="external">JavaScript 开发进阶：理解 JavaScript 作用域和作用域链</a></li>
<li><a href="http://www.cnblogs.com/georgewing/archive/2009/09/29/1576641.html" target="_blank" rel="external">PPK 谈 JavaScript 的 this 关键字</a></li>
</ul>

	
	
	
	
</div>
				
				

                <!-- Post Comments -->
                
                    
    <!-- 使用多说评论 -->
    <link rel="stylesheet" href="/css/duoshuo.min.css">
<style>
    #ds-thread #ds-reset .ds-post-button{
        background-color: #0097A7 !important;
    }
    #ds-wrapper #ds-reset .ds-icons-32{
        background-color: #0097A7 !important;
    }
    #ds-reset .ds-highlight {
        color: #0097A7 !important;
    }
</style>
<div id="comments">
    <!-- 多说评论框 start -->
        <div class="ds-thread" 
            data-thread-key="2015/05/04/Scope-Chain/" 
            data-url="http://vino24.cn/2015/05/04/Scope-Chain/"
            data-title="JavaScript作用域链"></div>
    <!-- 多说评论框 end -->
</div>



                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    
    <!-- Prev Nav -->
    
        <a href="/2015/05/16/CSS-hover/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2015/04/26/negative-margin/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>
        </div>
    </div>


				
					<!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay "></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored  sidebar-fixed-left" role="navigation">
	<div id="sidebar-main">
	    <!-- Sidebar Header -->
		<div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="vino24's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        jzwmxz@hotmail.com
        <b class="caret"></b>
    </a>
</div>

		<!-- Sidebar Navigation  -->
		<ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
			
                <li>
                    <a href="jzwmxz@hotmail.com" target="_blank" title="Email Me">
						<i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    <li id="sidebar-first-li">
        <a href="/" target="_self">
            <i class="material-icons sidebar-material-icons">home</i>
             主页
        </a>
    </li>

    <!-- I'm Feeling Lucky -->
<!--
    <li class="dropdown">
        <a href="" target="_self">
            <i class="material-icons sidebar-material-icons">explore</i>
             sidebar.imlucky
        </a>
    </li>
-->

	
    <!-- Archives  -->
    <li class="dropdown">
        <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
            <i class="material-icons sidebar-material-icons">inbox</i>
             归档
            <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
            <li>
            <a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">五月 2016<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">四月 2016<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/02/">二月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">一月 2016<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">十二月 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/09/">九月 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/08/">八月 2015<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/07/">七月 2015<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">六月 2015<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/05/">五月 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/04/">四月 2015<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/03/">三月 2015<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/01/">一月 2015<span class="sidebar_archives-count">1</span></a>
        </ul>
    </li>

    <!-- Divider -->
    <li class="divider"></li>


    <!-- Pages  -->
	
		<li>
			<a href="/about" title="关于我">
				关于我
			</a>
		</li>
	
		<li>
			<a href="/tags" title="标签云">
				标签云
			</a>
		</li>
	
		<li>
			<a href="links" title="友情链接">
				友情链接
			</a>
		</li>
	

    <!-- Article Numebr  -->
    <li>
        <a href="/archives">
             文章总数
             <span class="sidebar-badge">107</span>
        </a>
    </li>
</ul>

		<!-- Sidebar Divider -->
		<div class="sidebar-divider"></div>

		<!-- Sidebar Footer -->
		<!-- 
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持。 :) 
-->

<!-- Theme Material -->
<a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
	<div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		主题 - Material
		<span class="sidebar-badge badge-circle">i</span>
	</div>
</a>

<!-- Help & Support -->
<!--
<a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		sidebar.help
		<span class="mdl-button__ripple-container">
			<span class="mdl-ripple"></span>
		</span>
	</div>
</a>
-->

<!-- Feedback -->
<!--
<a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.feedback
                    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>
-->

<!-- Abount Theme -->
<!--
<a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.about_theme
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>-->

	</div>
    
    <!-- Sidebar Sponsor -->
    


</aside>

				

				
					<!-- Footer Top Button -->
					<div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>
				

				<!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
	
	
		<!-- Paradox Footer Left Section -->
		<div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
    
    
    <!-- Facebook -->
    
    
    
    <!-- Google + -->
    
    
    
    <!-- Weibo -->
    
    
    
    <!-- Instagram -->
    
    
    
    <!-- Tumblr -->
    
    
    
    <!-- Github -->
    
    <a href="https://github.com/vino24/" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
        <span class="visuallyhidden">Github</span>
    </button></a>
    
</div>


		<!--Copyright-->
		<div id="copyright">Copyright&nbsp;©&nbsp;<script type="text/javascript">var fd = new Date();document.write(fd.getFullYear());</script>&nbsp;逢十借一</div>

		<!-- Paradox Footer Right Section -->

		<!-- 
		I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright.
		It will not impact the appearance and can give developers a lot of support :)

		很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
		它不会影响美观并可以给开发者很大的支持。 :) 
		-->

		<div class="mdl-mini-footer--right-section">
			<div>
				<div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
				<div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
			</div>
		</div>
	
    
</footer>

				<!-- Import File -->
<script src="/js/highlight.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    
    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });
    
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>








    <!-- 多说公共 js 代码 start -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"vino24"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = 'https://static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
             || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- 多说公共 js 代码 end -->




<!-- Swiftye -->


<!-- Local Search-->

	<script>
	var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        success: function( xmlResponse ) {
            // get the contents from search data
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length <= 0) {
                    return;
                }
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        str += "<li><a href='"+ data_url +"' class='search-result-title' target='_blank'>"+ data_title;
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out characters
                            var start = first_occur - 6;
                            var end = first_occur + 6;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 10;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substr(start, end); 
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<em class=\"search-keyword\">"+keyword+"</em>");
                            })
                            str += "<p class=\"search-result\">" + match_content +"...</p>" +"</a>";
                        }
                    }
                })
                $resultContent.innerHTML = str;
            })
        }
    })
}
</script>

	<script>
        var inputArea = document.querySelector("#search");
        var getSearchFile = function(){
            var path = "search.xml";
            searchFunc(path, 'search', 'local-search-result');
        }

        inputArea.onfocus = function(){ getSearchFile() }
	</script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $(".post-toc-wrap").parent(".mdl-menu__container").css("position", "fixed");
    });
</script>

<!-- MathJax Load-->

            </main>
        </div>

    </body>

	
</html>
